<!-- popular courses section start -->
<section class="popular">
	<div class="container">
		<div class="popular_header">
			<h2 class="popular_header-title" data-aos="fade-up">Popular courses</h2>
			<p class="popular_header-text" data-aos="fade-down">
				Discover the most popular courses in our learning platform. Join thousands of
				students and start your learning journey today.
			</p>
		</div>

		{% set popular_categories = frappe.db.sql("SELECT c.category, COUNT(c.name) as course_count
		FROM `tabLMS Course` c WHERE c.published = 1 AND c.category IS NOT NULL AND c.category !=
		'' GROUP BY c.category ORDER BY course_count DESC LIMIT 6", as_dict=True) %}

		<ul
			class="popular_tags courses-tags d-flex flex-wrap align-items-center justify-content-center"
		>
			{% for category in popular_categories %}
			<li class="list-item" data-aos="fade-left" data-aos-delay="{{ loop.index0 * 50 }}">
				<a class="tag" href="/lms/courses?category={{ category.category }}"
					>{{ category.category }}</a
				>
			</li>
			{% endfor %}
		</ul>

		{% set popular_courses = frappe.db.get_list('LMS Course', filters={'published': 1},
		fields=['name', 'title', 'short_introduction', 'image', 'category', 'enrollments',
		'rating', 'lessons', 'course_price', 'currency', 'paid_course', 'card_gradient'],
		order_by='enrollments desc', page_length=3) %}

		<ul class="popular_list d-md-flex flex-wrap">
			{% for course in popular_courses %} {% set instructor_email =
			frappe.db.get_value('Course Instructor', {'parent': course.name, 'parenttype': 'LMS
			Course'}, 'instructor') %} {% set instructor_name = frappe.db.get_value('User',
			instructor_email, 'full_name') if instructor_email else 'Unknown' %} {% set
			rating_filled = (course.rating or 0)|int %} {% set rating_empty = 5 - rating_filled %}

			<li
				class="popular_list-card course-card col-12 col-md-6 col-lg-4"
				data-aos="fade-up"
				data-aos-delay="{{ loop.index0 * 50 }}"
			>
				<div class="course-card_wrapper">
					<div class="top d-flex align-items-start">
						<span
							class="top_icon top_icon--{{ ['blue', 'orange', 'sky'][loop.index0 % 3] }}"
						>
							<i
								class="icon-{{ ['code', 'css3', 'sitemap'][loop.index0 % 3] }}-solid icon"
							></i>
						</span>
						<div class="wrapper d-flex flex-column">
							<h5 class="top_title">{{ course.title }}</h5>
							<ul class="rating d-flex align-items-center">
								{% for i in range(rating_filled) %}
								<li class="rating_star">
									<i class="icon-star icon"></i>
								</li>
								{% endfor %} {% for i in range(rating_empty) %}
								<li class="rating_star rating_star--empty">
									<i class="icon-star icon"></i>
								</li>
								{% endfor %}
							</ul>
							<span class="top_author">by {{ instructor_name }}</span>
							<span class="top_details">{{ course.lessons or 0 }} lectures</span>
						</div>
					</div>
					<div class="pricing">
						{% if course.paid_course %}
						<span class="pricing_price h5"
							>{{ course.currency }} {{ course.course_price }}</span
						>
						{% else %}
						<span class="pricing_price h5">Free</span>
						{% endif %}
					</div>
					<div class="bottom">
						<ul class="bottom_list">
							<li class="bottom_list-item d-flex align-items-start">
								<i class="bottom_list-item_marker icon-circle"></i>
								<p class="bottom_list-item_text">
									{{ course.short_introduction or 'Learn from the best
									instructors' }}
								</p>
							</li>
							<li class="bottom_list-item d-flex align-items-start">
								<i class="bottom_list-item_marker icon-circle"></i>
								<p class="bottom_list-item_text">
									{{ course.enrollments or 0 }} students enrolled
								</p>
							</li>
						</ul>
						<a
							class="bottom_btn btn btn--bordered btn--arrow"
							href="/lms/courses/{{ course.name }}"
						>
							View course details <i class="icon-arrow-right-solid icon"></i>
						</a>
					</div>
				</div>
			</li>
			{% endfor %}
		</ul>
		<a class="popular_btn btn btn--gradient" href="/lms/courses">
			<span class="text">Learn more</span>
		</a>
	</div>
</section>
<!-- popular courses section end -->
